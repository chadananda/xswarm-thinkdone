---
import '../styles/global.css';
import TodoList from '../components/TodoList.svelte';
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#8b4513">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Think → Done</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&family=Inter:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="page">
    <header class="brand">
      <div class="brand-row">
        <h1>Think <span class="arrow">&rarr;</span> Done</h1>
        <div class="brand-right">
          <span class="date" id="date"></span>
          <button class="header-btn mic-btn" id="micBtn" title="Quick meeting">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          </button>
        </div>
      </div>
      <div class="quote" id="quote"></div>
    </header>
    <main>
      <TodoList client:load />
    </main>
    <footer class="footer" id="ts"></footer>
  </div>

  <button class="fab" id="addBtn" title="Add task">+</button>

  <script>
    const QUOTES = [
      "Done is the engine of more.",
      "Finished is better than perfect.",
      "Small steps still move you forward.",
      "What gets scheduled gets done.",
      "Progress, not perfection.",
      "Today\u2019s priorities shape tomorrow\u2019s possibilities.",
      "The best plan is the one you actually follow.",
      "Clarity precedes action.",
      "Less deciding, more doing.",
      "Your future self will thank you.",
      "Focus is saying no to good ideas.",
      "Action cures anxiety.",
      "Ship it. Then improve it.",
      "One thing at a time. Most important thing first.",
      "Think strategically. Execute relentlessly.",
    ];
    let qi = Math.floor(Math.random() * QUOTES.length);
    const quoteEl = document.getElementById('quote');
    if (quoteEl) {
      quoteEl.textContent = '\u201C' + QUOTES[qi] + '\u201D';
      quoteEl.style.transition = 'opacity 0.4s';
      setInterval(() => {
        quoteEl.style.opacity = '0';
        setTimeout(() => {
          qi = (qi + 1) % QUOTES.length;
          quoteEl.textContent = '\u201C' + QUOTES[qi] + '\u201D';
          quoteEl.style.opacity = '1';
        }, 400);
      }, 12000);
    }

    // Date display
    const dateEl = document.getElementById('date');
    if (dateEl) {
      const d = new Date();
      dateEl.textContent = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    // Time in footer
    function updateTime() {
      const el = document.getElementById('ts');
      if (el) el.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    updateTime();
    setInterval(updateTime, 60000);

    // (+) button focuses the add input
    document.getElementById('addBtn')?.addEventListener('click', () => {
      const input = document.querySelector('.add-input');
      if (input) { input.focus(); input.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
    });

    // Mic button placeholder
    document.getElementById('micBtn')?.addEventListener('click', () => {
      alert('Ad-hoc meeting — coming soon!');
    });

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>

<style is:global>
  .page {
    max-width: 520px;
    margin: 0 auto;
    padding: 0 1rem 1.5rem;
    min-height: 100vh;
    border-left: 2px solid var(--color-margin);
    border-right: 1px solid var(--color-rule);
    background: color-mix(in srgb, var(--color-paper-bright) 50%, transparent);
  }

  @media (max-width: 540px) {
    .page {
      padding: 0 0.4rem 1rem;
      border-left: none;
      border-right: none;
      max-width: 100%;
    }
  }

  .brand {
    padding: 0.3rem 0 0.2rem;
    border-bottom: 2px solid var(--color-ink-faint);
    margin-bottom: 0.15rem;
    position: sticky;
    top: 0;
    background: color-mix(in srgb, var(--color-paper) 97%, transparent);
    z-index: 10;
    backdrop-filter: blur(8px);
  }
  .brand-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }
  .brand-right {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
  }
  .brand h1 {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.5rem;
    color: var(--color-ink-light);
    line-height: 1;
    white-space: nowrap;
  }
  .brand h1 .arrow { color: var(--color-gold); font-weight: 400; }
  .brand .date {
    font-family: var(--font-ui);
    font-size: 0.6rem;
    color: var(--color-ink-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
  }
  .header-btn {
    appearance: none;
    border: 1px solid var(--color-ink-faint);
    background: transparent;
    color: var(--color-ink-muted);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s, border-color 0.15s, background 0.15s;
    padding: 0;
  }
  .header-btn:hover {
    color: var(--color-accent);
    border-color: var(--color-accent);
    background: rgba(139,69,19,0.05);
  }
  .mic-btn {
    width: 24px; height: 24px;
    padding: 4px;
  }
  .brand .quote {
    font-family: var(--font-display);
    font-size: 1rem;
    color: var(--color-ink-light);
    font-style: italic;
    margin-top: 0.05rem;
    min-height: 1em;
    line-height: 1.2;
  }

  .footer {
    font-family: var(--font-ui);
    font-size: 0.65rem;
    color: var(--color-done);
    text-align: center;
    margin-top: 1rem;
    padding-top: 0.4rem;
    border-top: 1px solid var(--color-rule);
  }

  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    background: var(--color-accent);
    color: white;
    font-size: 1.8rem;
    font-weight: 300;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 3px 12px rgba(0,0,0,0.2), 0 1px 4px rgba(0,0,0,0.12);
    transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
    z-index: 50;
    padding: 0;
    padding-bottom: 1px;
  }
  .fab:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 18px rgba(0,0,0,0.25);
    background: var(--color-gold);
  }
  .fab:active { transform: scale(0.95); }
</style>
